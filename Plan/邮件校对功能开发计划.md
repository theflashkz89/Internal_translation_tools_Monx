---
name: 邮件校对功能开发
overview: 在现有翻译工具中新增「邮件校对」页面，支持用户粘贴邮件草稿后选择校对模式、目标语言和语气，通过 DeepSeek AI 进行智能校对，并排显示原文与修改版本。
todos:
  - id: create-plan-folder
    content: 创建 Plan 文件夹
    status: pending
  - id: add-proofread-function
    content: 在 utils.py 中添加 proofread_email() 函数
    status: pending
    dependencies:
      - create-plan-folder
  - id: add-page-ui
    content: 在 app.py 中添加邮件校对页面 UI 和逻辑
    status: pending
    dependencies:
      - add-proofread-function
  - id: test-feature
    content: 测试邮件校对功能
    status: pending
    dependencies:
      - add-page-ui
---

# 邮件校对功能开发计划

> **重要原则**：实施当前需求的时候不要动其他部分，每次做完以后都要测试

---

## 最小实施步骤

按以下顺序逐步实施，每完成一步都要测试验证：

### Step 1: 创建 Plan 文件夹

```
操作：在项目根目录创建 Plan/ 文件夹
验证：确认文件夹已创建
```

### Step 2: 添加 proofread_email() 函数

```
文件：utils.py（仅在文件末尾添加，不修改其他代码）
操作：添加新函数 proofread_email()
验证：函数语法正确，无报错
```

### Step 3: 添加侧边栏导航项

```
文件：app.py 第13行
操作：在 st.radio 选项中添加 "📧 邮件校对"
验证：运行应用，确认侧边栏显示新选项
```

### Step 4: 添加邮件校对页面 UI

```
文件：app.py 末尾（第374行之后）
操作：添加 elif selected_page == "📧 邮件校对": 区块
验证：点击新选项，页面正常显示
```

### Step 5: 完整功能测试

```
操作：输入测试邮件，验证校对功能
验证：校对结果正确显示，复制按钮可用
```

---

## 功能概述

新增「邮件校对」页面，用户可以：

- 粘贴邮件草稿
- 选择校对模式（仅语法修正 / 润色改进）
- 选择目标语言（中文、英文、意大利语）
- 选择语气（友好、正式、简洁）
- 输入自定义术语要求
- 获得 AI 校对后的邮件，并排对比原文

---

## 实现方案

### 1. 创建 Plan 文件夹

在项目根目录创建 `Plan/` 文件夹用于存放计划文档。

### 2. 修改主应用 [app.py](app.py)

- 在侧边栏导航中添加新选项「📧 邮件校对」
- 新增第5个页面区块，实现邮件校对 UI

### 3. 页面 UI 设计

```
┌─────────────────────────────────────────────────────┐
│  📧 邮件校对                                         │
│  使用 AI 智能校对您的邮件草稿                          │
├─────────────────────────────────────────────────────┤
│  [校对模式] ○ 仅语法修正  ○ 润色改进                   │
│  [目标语言] 中文 ▼    [语气风格] 正式 ▼               │
│  [自定义术语/要求] ___________________________       │
├─────────────────────────────────────────────────────┤
│  📝 粘贴邮件草稿                                      │
│  ┌─────────────────────────────────────────────┐    │
│  │                                             │    │
│  │  (文本输入区)                                │    │
│  │                                             │    │
│  └─────────────────────────────────────────────┘    │
│                                                     │
│  [🚀 开始校对]                                       │
├─────────────────────────────────────────────────────┤
│  ┌──────────────────┐  ┌──────────────────┐         │
│  │ 📄 原文          │  │ ✨ 校对后        │         │
│  │                  │  │                  │         │
│  │  (原始邮件)      │  │  (校对后邮件)    │         │
│  │                  │  │                  │         │
│  └──────────────────┘  └──────────────────┘         │
│                        [📋 复制校对结果]             │
└─────────────────────────────────────────────────────┘
```

### 4. 在 [utils.py](utils.py) 中添加校对函数

新增 `proofread_email()` 函数：

- 接收参数：邮件内容、校对模式、目标语言、语气、自定义术语
- 构建智能 Prompt，包含：
    - 校对模式指令（仅语法 vs 润色）
    - 目标语言要求
    - 语气风格要求
    - 保留签名格式的指令
    - 自定义术语的处理
- 调用现有的 `call_deepseek_api()` 函数
- 返回校对后的邮件文本

### 5. Prompt 设计要点

```
系统提示词模板：
- 角色：专业邮件校对助手
- 模式：{仅语法修正/润色改进}
- 语言：输出使用{目标语言}
- 语气：{友好/正式/简洁}
- 规则：
  * 保留邮件签名格式
  * 应用用户指定的术语
  * 不输出任何 Markdown 格式符号
  * 仅输出校对后的邮件正文
```

---

## 技术细节

| 项目 | 说明 |
|------|------|
| AI 服务 | 复用现有 `call_deepseek_api()` |
| UI 框架 | Streamlit（与现有页面一致） |
| 样式 | 复用 `apply_custom_styles()` |
| 复制功能 | 复用现有邮件助手的复制按钮组件 |

---

## 文件变更清单

| 文件 | 操作 |
|------|------|
| `Plan/` | 新建文件夹 |
| `app.py` | 添加新页面入口和 UI |
| `utils.py` | 添加 `proofread_email()` 函数 |
